package main

import (
	"fmt"
	"net"
)

func main() {
	// ==========================================
	// ШАГ 1: Создаём "слушатель" на порту 8080
	// ==========================================

	// net.Listen создаёт точку, куда могут подключаться другие программы
	//
	// "tcp" — протокол (способ передачи данных)
	//        TCP = надёжный, данные дойдут в правильном порядке
	//
	// ":8080" — порт (как номер квартиры в доме)
	//          Компьютер = дом
	//          Порт = номер квартиры
	//          Программы "живут" на разных портах
	//
	listener, err := net.Listen("tcp", ":8080")

	// Проверяем ошибку
	// err != nil означает "ошибка есть"
	if err != nil {
		fmt.Println("Ошибка при создании сервера:", err)
		return // выходим из программы
	}

	// defer = "сделай это когда функция закончится"
	// Закрываем слушатель когда программа завершится
	defer listener.Close()

	fmt.Println("Сервер запущен!")
	fmt.Println("Жду подключения на порту 8080...")
	fmt.Println("")

	// ==========================================
	// ШАГ 2: Ждём подключения клиента
	// ==========================================

	// Accept() — ждёт пока кто-то подключится
	// Программа ОСТАНОВИТСЯ здесь и будет ждать
	// Когда клиент подключится — продолжит работу
	//
	// conn (connection) — соединение с клиентом
	//                     через него будем получать данные
	conn, err := listener.Accept()

	if err != nil {
		fmt.Println("Ошибка подключения:", err)
		return
	}

	defer conn.Close()

	fmt.Println("Клиент подключился!")
	fmt.Println("")

	// ==========================================
	// ШАГ 3: Читаем сообщение от клиента
	// ==========================================

	// Создаём "буфер" — место куда положим полученные данные
	// make([]byte, 1024) — срез на 1024 байта (1 КБ)
	// Этого хватит для короткого сообщения
	buffer := make([]byte, 1024)

	// conn.Read(buffer) — читаем данные из соединения в буфер
	// n — сколько байт реально прочитали
	//
	// Например: отправили "hello" (5 байт)
	// buffer будет: ['h','e','l','l','o', 0, 0, 0, ... ещё 1019 нулей]
	// n будет: 5
	n, err := conn.Read(buffer)

	if err != nil {
		fmt.Println("Ошибка чтения:", err)
		return
	}

	// buffer[:n] — берём только первые n байт (реальное сообщение)
	// string(...) — превращаем байты в строку
	message := string(buffer[:n])

	fmt.Println("Получено сообщение:")
	fmt.Println(message)
}
